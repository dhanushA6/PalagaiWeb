"use strict";(self.webpackChunkkta_utchol=self.webpackChunkkta_utchol||[]).push([[6158],{5338:(e,t,a)=>{var r=a(86672);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},16158:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var r=a(45458),n=a(10467),s=a(80296),o=a(54756),l=a.n(o),c=a(44914),u=a(99180),i=a(8700),d=a(30660),v=a(83550),p=a(31129),m=a(612),h=a(9419),f=(a(28870),a(5338)),g=a(30955),k=a(74848),x=(0,c.createContext)(),S=function(){var e=(0,u.useNavigate)(),t=(0,c.useContext)(x),a=t.userID,o=t.levelValue,i=t.mode,d=(0,c.useState)(0),m=(0,s.A)(d,2),f=m[0],g=m[1],S=(0,c.useState)(null),L=(0,s.A)(S,2),A=L[0],y=L[1],w=(0,c.useState)(!0),C=(0,s.A)(w,2),j=C[0],b=C[1],R=(0,c.useState)(null),D=(0,s.A)(R,2),M=D[0],I=D[1],N=(0,c.useState)(0),E=(0,s.A)(N,2),T=E[0],O=E[1],V=(0,c.useState)({}),P=(0,s.A)(V,2),J=P[0],U=P[1],_=(0,c.useState)({}),B=(0,s.A)(_,2),F=B[0],q=B[1],G=(0,c.useState)({}),H=(0,s.A)(G,2),z=H[0],K=H[1],Q=(0,c.useState)([]),W=(0,s.A)(Q,2),X=W[0],Y=W[1];(0,c.useRef)(!1),(0,c.useEffect)((function(){a&&o&&i&&Z(o,a,i)}),[a,o,i]);var Z=function(){var e=(0,n.A)(l().mark((function e(t,a,r){var n,s,o,c;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),e.prev=1,n=new URLSearchParams({level:t,userid:a,mode:r}).toString(),e.next=5,fetch("https://thambaa.karky.in:6128/thamba/game/palagai/play?".concat(n));case 5:return s=e.sent,e.next=8,s.json();case 8:if((o=e.sent).letters)try{c="string"==typeof o.letters?JSON.parse(o.letters):o.letters,K(c),console.log("Letters data loaded:",c)}catch(e){console.error("Error parsing letters data:",e),K({})}else K({});y(o),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),I(e.t0.message);case 16:return e.prev=16,b(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})));return function(t,a,r){return e.apply(this,arguments)}}(),$=function(){var t=(0,n.A)(l().mark((function t(){var n,s,c,u,d,v,p,m,h,k,x,S=arguments;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=S.length>0&&void 0!==S[0]?S[0]:100,s=S.length>1&&void 0!==S[1]?S[1]:0,O((function(e){return e+n})),c=A.contents[f],u={task:c.task,type:c.type,taskid:c.taskid,accuracy:n.toString(),wpm:"0",cpm:"0",timeTaken:s.toString(),found:"true"},Y((function(e){return[].concat((0,r.A)(e),[u])})),f===A.contents.length-1){t.next=11;break}g((function(e){return e+1})),t.next=50;break;case 11:return t.prev=11,(d=new URLSearchParams).append("mode",i),d.append("userid",a),d.append("level",o.toString()),d.append("contents",JSON.stringify([].concat((0,r.A)(X),[u]))),d.append("letters",JSON.stringify(z)),console.log("POST Request Body:"),console.log("Form Data:",d.toString()),console.log("Mode:",i),console.log("UserID:",a),console.log("Level:",o.toString()),console.log("Contents:",JSON.stringify([].concat((0,r.A)(X),[u]),null,2)),console.log("Letters:",JSON.stringify(z,null,2)),t.next=27,fetch("https://thambaa.karky.in:6128/thamba/game/palagai/update",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:d.toString()});case 27:if(t.sent.ok){t.next=30;break}throw new Error("Failed to update game data");case 30:if("freeplay"!==i){t.next=38;break}return t.next=33,Z(o,a,i);case 33:O(0),Y([]),g(0),t.next=44;break;case 38:e("/game/complete",{state:{totalScore:T+n,currentLevelMistakes:J,currentLevelCorrect:F,letterData:z,totalTasks:(null==A||null===(v=A.contents)||void 0===v?void 0:v.length)||0,taskMetrics:[].concat((0,r.A)(X),[u])}}),p=[].concat((0,r.A)(X),[u]),m=p.length>0?Math.round(p.reduce((function(e,t){return e+Number(t.accuracy)}),0)/p.length):0,h=p.reduce((function(e,t){return e+Number(t.timeTaken)}),0),k={type:"levelComplete",data:{level:o,timeTaken:h,points:m}},window.parent.postMessage(k,"*");case 44:t.next=50;break;case 46:t.prev=46,t.t0=t.catch(11),console.error("Error updating game data:",t.t0),e("/game/complete",{state:{totalScore:T+n,currentLevelMistakes:J,currentLevelCorrect:F,letterData:z,totalTasks:(null==A||null===(x=A.contents)||void 0===x?void 0:x.length)||0,taskMetrics:[].concat((0,r.A)(X),[u])}});case 50:case"end":return t.stop()}}),t,null,[[11,46]])})));return function(){return t.apply(this,arguments)}}();if(j)return(0,k.jsx)("div",{children:"Loading..."});if(M)return(0,k.jsxs)("div",{children:["Error: ",M]});if(!A||!A.contents)return(0,k.jsx)("div",{children:"No game data available"});var ee=A.contents[f];return"Teach"===ee.type&&(0,h.uC)(ee.task)?(0,k.jsx)(p.A,{task:ee,onComplete:$,currentLevelMistakes:J,currentLevelCorrect:F,setCurrentLevelMistakes:U,setCurrentLevelCorrect:q,letterData:z,setLetterData:K,mode:i,userID:a,level:o}):(0,k.jsx)(v.A,{task:ee,onComplete:$,currentLevelMistakes:J,currentLevelCorrect:F,setCurrentLevelMistakes:U,setCurrentLevelCorrect:q,letterData:z,setLetterData:K,mode:i,userID:a,level:o})},L=function(){(0,u.useNavigate)();var e,t,a,r,n,s,o=(0,u.useLocation)(),l=(null===(e=o.state)||void 0===e?void 0:e.totalScore)||0,c=(null===(t=o.state)||void 0===t?void 0:t.currentLevelMistakes)||{},i=(null===(a=o.state)||void 0===a?void 0:a.currentLevelCorrect)||{},d=(null===(r=o.state)||void 0===r?void 0:r.letterData)||{},v=(null===(n=o.state)||void 0===n?void 0:n.totalTasks)||0,p=(null===(s=o.state)||void 0===s?void 0:s.taskMetrics)||[];return(0,k.jsx)("div",{className:"completion-screen",children:(0,k.jsx)(m.A,{score:l,totalTasks:v,currentLevelMistakes:c,currentLevelCorrect:i,letterData:d,taskMetrics:p})})};function A(){var e=(0,c.useState)(1),t=(0,s.A)(e,2),a=t[0],r=t[1],n=(0,c.useState)(9),o=(0,s.A)(n,2),l=o[0],v=o[1],p=(0,c.useState)("activity"),m=(0,s.A)(p,2),h=m[0],f=m[1];return(0,c.useEffect)((function(){(0,g.a)();var e=function(e){if(e.data&&e.data.userID&&e.data.levelValue&&e.data.mode){var t=e.data,a=t.userID,n=t.levelValue,s=t.mode;r(a),v(n),f(s),console.log("Received userID:",a,"levelValue:",n,"mode:",s)}else console.warn("Invalid message received:",e.data)};return window.addEventListener("message",e),function(){window.removeEventListener("message",e)}}),[]),(0,k.jsx)(x.Provider,{value:{userID:a,levelValue:l,mode:h},children:(0,k.jsx)(u.HashRouter,{basename:"MISSING_ENV_VAR".PUBLIC_URL,children:(0,k.jsxs)(u.Routes,{children:[(0,k.jsx)(u.Route,{path:"/",element:(0,k.jsx)(i.A,{})}),(0,k.jsx)(u.Route,{path:"/help",element:(0,k.jsx)(d.A,{})}),(0,k.jsx)(u.Route,{path:"/game",element:(0,k.jsx)(S,{})}),(0,k.jsx)(u.Route,{path:"/game/complete",element:(0,k.jsx)(L,{})})]})})})}var y=document.getElementById("app");if(!y)throw new Error("Failed to find the root element");f.createRoot(y).render((0,k.jsx)(A,{}));const w=A}}]);